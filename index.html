<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>GACHA</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;background:#020617;color:#fff;font-family:system-ui;text-align:center}
button{padding:6px 12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
.hidden{display:none}
.card{padding:16px;border-radius:14px;margin:6px}
.N{background:#334155}
.R{background:#2563eb}
.SR{background:#7c3aed}
.SSR{background:linear-gradient(135deg,#fde047,#f59e0b);color:#000}
.SSSR{background:linear-gradient(135deg,#22d3ee,#a855f7,#fde047);color:#000;box-shadow:0 0 20px #a855f7}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px}
.book-card{padding:10px;border-radius:10px;font-size:12px}
.unknown{background:#020617;color:#64748b;border:1px dashed #334155}
.calendar{background:#020617;padding:12px;border-radius:12px}
.cal-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
.cal-day{background:#111827;padding:8px;border-radius:8px;font-size:11px}
.done{background:#065f46}
.today{background:#fde047;color:#000}
.reward{background:#14532d;color:#bbf7d0;padding:8px;border-radius:10px;margin:8px}
</style>
</head>
<body>

<h1>GACHA</h1>

<div>
ç„¡å„ŸçŸ³:<span id="free"></span> /
æœ‰å„ŸçŸ³:<span id="paid"></span> /
money:<span id="money"></span>å††
</div>

<button onclick="pull1()">å˜ç™º</button>
<button onclick="pull10()">10é€£</button>
<button onclick="paid10()">æœ‰å„Ÿ10é€£(SSRä»¥ä¸Šç¢ºå®š)</button>
<button onclick="openCalendar()">ğŸ“…ãƒ­ã‚°ã‚¤ãƒ³</button>
<button onclick="openInv()">ğŸ“¦æ‰€æŒ</button>
<button onclick="openBook()">ğŸ“–ã‚­ãƒ£ãƒ©å›³é‘‘</button>

<div id="gacha" class="grid"></div>
<div id="inv" class="hidden"></div>
<div id="book" class="hidden"></div>
<div id="calendar" class="hidden"></div>

<hr>
<button onclick="buyPaid()">ğŸ’³ æœ‰å„ŸçŸ³è³¼å…¥</button>
<button onclick="exportSave()">ğŸ“¤ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
<button onclick="importSave()">ğŸ“¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
<button onclick="resetSave()">ğŸ—‘ã‚»ãƒ¼ãƒ–å‰Šé™¤</button>

<script>
const SAVE_KEY="gacha_save_v4";

const chars=[
{id:1,name:"ã‚¢ãƒ«ã‚»ãƒ¼ãƒŒ",r:"N",sell:500},
{id:2,name:"ãƒ”ã‚¯ã‚·ãƒ¼",r:"N",sell:500},
{id:3,name:"ãƒ¢ã‚³ã‚¤",r:"R",sell:750},
{id:4,name:"ã‚­ãƒ³ã‚­",r:"R",sell:750},
{id:5,name:"ãƒ‡ã‚«ãƒ©ãƒ“ã‚¢",r:"SR",sell:1500},
{id:6,name:"ãƒŠãƒ¼ã‚¬ãƒ©ã‚¸ãƒ£",r:"SR",sell:1500},
{id:7,name:"ã‚µã‚¿ãƒŠã‚¨ãƒ«",r:"SSR",sell:3000},
{id:8,name:"ä¼Šé‚ªé‚£å²å¤§ç¥",r:"SSR",sell:3000},
{id:9,name:"ä¼Šé‚ªé‚£å²å¤§ç¥ãƒ»è³Šç¥",r:"SSSR",sell:5000},
];

const rate=[
{r:"N",p:60},
{r:"R",p:25},
{r:"SR",p:10},
{r:"SSR",p:4},
{r:"SSSR",p:1},
];

function loadSave(){
 const raw=localStorage.getItem(SAVE_KEY);
 if(raw) return JSON.parse(raw);
 return{
  freeStone:5000,
  paidStone:0,
  money:10000,
  owned:{},
  book:{},
  bookReward:false,
  loginDay:0,
  lastLogin:""
 };
}
let save=loadSave();

function clamp(){
 save.freeStone=Math.max(0,save.freeStone);
 save.paidStone=Math.max(0,save.paidStone);
 save.money=Math.max(0,save.money);
}
function saveData(){
 clamp();
 localStorage.setItem(SAVE_KEY,JSON.stringify(save));
}
function update(){
 free.textContent=save.freeStone;
 paid.textContent=save.paidStone;
 money.textContent=save.money;
 saveData();
}
update();

/* ===== ãƒ­ã‚°ã‚¤ãƒ³ ===== */
const today=new Date().toDateString();
const y=new Date(Date.now()-86400000).toDateString();
if(save.lastLogin!==today){
 save.loginDay=(save.lastLogin===y)?save.loginDay+1:1;
 save.freeStone+=1000+(save.loginDay-1)*100;
 save.lastLogin=today;
 update();
}

/* ===== ã‚¬ãƒãƒ£ ===== */
function draw(){
 let r=Math.random()*100,sum=0;
 for(const x of rate){
  sum+=x.p;
  if(r<sum){
   const pool=chars.filter(c=>c.r===x.r);
   return pool[Math.floor(Math.random()*pool.length)];
  }
 }
}
function checkBookReward(){
 const got=Object.keys(save.book).length;
 if(got===chars.length && !save.bookReward){
  save.bookReward=true;
  save.freeStone+=10000;
  alert("ğŸ‰ å›³é‘‘100%é”æˆï¼\nç„¡å„ŸçŸ³10000å€‹ã‚’ç²å¾—ã—ã¾ã—ãŸï¼");
 }
}
function show(list){
 gacha.innerHTML="";
 list.forEach(c=>{
  gacha.innerHTML+=`<div class="card ${c.r}">${c.name}<br>${c.r}</div>`;
  save.owned[c.id]=(save.owned[c.id]||0)+1;
  if(!save.book[c.id]){
   save.book[c.id]=true;
   checkBookReward();
  }
 });
 update();
}
function pull1(){
 if(save.freeStone<300)return;
 save.freeStone-=300;
 show([draw()]);
}
function pull10(){
 if(save.freeStone<3000)return;
 save.freeStone-=3000;
 show(Array.from({length:10},draw));
}
function paid10(){
 if(save.paidStone<3000)return;
 save.paidStone-=3000;
 const ssrPlus=chars.filter(c=>c.r==="SSR"||c.r==="SSSR");
 const res=[ssrPlus[Math.floor(Math.random()*ssrPlus.length)]];
 while(res.length<10)res.push(draw());
 show(res);
}

/* ===== æ‰€æŒ ===== */
function openInv(){
 let h="<h2>æ‰€æŒã‚­ãƒ£ãƒ©</h2><div class='grid'>";
 for(const c of chars){
  const n=save.owned[c.id]||0;
  if(n>0){
   h+=`<div class="book-card ${c.r}">
   ${c.name} x${n}<br>
   <button onclick="sell(${c.id})">å£²å´</button>
   </div>`;
  }
 }
 inv.innerHTML=h+"</div><button onclick='inv.classList.add(\"hidden\")'>æˆ»ã‚‹</button>";
 inv.classList.remove("hidden");
}
function sell(id){
 if(!save.owned[id])return;
 save.owned[id]--;
 save.money+=chars.find(c=>c.id===id).sell;
 update();
 openInv();
}

/* ===== å›³é‘‘ ===== */
function openBook(){
 const got=Object.keys(save.book).length;
 const rateP=Math.floor(got/chars.length*100);
 let h=`
 <h2>ã‚­ãƒ£ãƒ©å›³é‘‘</h2>
 <div>é”æˆç‡ï¼š${rateP}%ï¼ˆ${got}/${chars.length}ï¼‰</div>
 ${rateP===100?'<div class="reward">ğŸ‰ å›³é‘‘ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆé”æˆï¼</div>':""}
 <br><div class='grid'>`;
 for(const c of chars){
  if(save.book[c.id]){
   h+=`<div class="book-card ${c.r}">${c.name}<br>${c.r}</div>`;
  }else{
   h+=`<div class="book-card unknown">ï¼Ÿï¼Ÿï¼Ÿ<br>${c.r}</div>`;
  }
 }
 book.innerHTML=h+"</div><button onclick='book.classList.add(\"hidden\")'>æˆ»ã‚‹</button>";
 book.classList.remove("hidden");
}

/* ===== ãã®ä»– ===== */
function buyPaid(){
 if(save.money<1000)return;
 save.money-=1000;
 save.paidStone+=1000;
 update();
}
function openCalendar(){
 let h="<div class='calendar'><div class='cal-grid'>";
 for(let i=1;i<=30;i++){
  let cls="cal-day";
  if(i<save.loginDay)cls+=" done";
  else if(i===save.loginDay)cls+=" today";
  h+=`<div class="${cls}">${i}æ—¥<br>${1000+(i-1)*100}</div>`;
 }
 calendar.innerHTML=h+"</div><button onclick='calendar.classList.add(\"hidden\")'>é–‰ã˜ã‚‹</button></div>";
 calendar.classList.remove("hidden");
}
function exportSave(){
 prompt("ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„",btoa(JSON.stringify(save)));
}
function importSave(){
 const t=prompt("è²¼ã‚Šä»˜ã‘");
 if(!t)return;
 try{save=JSON.parse(atob(t));update();}
 catch{alert("å¤±æ•—");}
}
function resetSave(){
 if(confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
  localStorage.removeItem(SAVE_KEY);
  location.reload();
 }
}
</script>
</body>
</html>
